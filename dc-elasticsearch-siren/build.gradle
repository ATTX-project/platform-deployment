apply plugin: 'com.chrisgahlert.gradle-dcompose-plugin'
apply plugin: 'de.undercouch.download'

if (!project.hasProperty("registryUrl")) {
    ext.registryUrl = "http://attx-dev.hulib.helsinki.fi:5000"
}

repositories {
    mavenCentral()
}

import de.undercouch.gradle.tasks.download.Download
task downloadJars(type:Download) {
    // TODO: Change this to use artifact repository
    src 'http://attx-dev:49001/job/dc-elasticsearch-siren-pipeline/lastSuccessfulBuild/artifact/dc-elasticsearch-siren/attx-api-plugin/build/libs/attx-api-plugin-1.0-SNAPSHOT.jar'
    dest "$buildDir"

}

dcompose {
  registry ("${registryUrl}") {
  }
  essiren {
    baseDir = file('.')
    dockerFilename = 'Dockerfile'
    repository = 'attx-dev:5000/essiren:latest'
    exposedPorts = ['9200', '9300']
    portBindings = ['9200:9200', '9300:9300']
  }
}
